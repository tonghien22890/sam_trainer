---
description: >
  Hybrid Conservative BÃ¡o SÃ¢m Model: mÃ´ táº£ má»¥c tiÃªu, rulebase, feature design
  vÃ  Ä‘á»‹nh hÆ°á»›ng training. Má»¥c tiÃªu: huáº¥n luyá»‡n model há»c style build sequence
  combo unbeatable tá»« hÃ nh vi user, thay vÃ¬ meta risk gÃ¡n ngoÃ i.
globs: ["src/models/sam_hybrid/**"]
alwaysApply: true
---

# Hybrid Conservative BÃ¡o SÃ¢m Model â€“ Design Context

## ğŸ¯ Má»¥c tiÃªu
- **Input**: Má»™t bá»™ bÃ i cá»¥ thá»ƒ.
- **Output**: Má»™t sequence combo unbeatable (khÃ´ng ai cháº·n Ä‘Æ°á»£c).
- **Model cáº§n há»c**:
  - CÃ¡ch user build sequence (Æ°u tiÃªn loáº¡i combo nÃ o).
  - Sá»©c máº¡nh tá»«ng combo vÃ  tá»•ng quan sequence.
  - Phong cÃ¡ch chÆ¡i (conservative/aggressive) thá»ƒ hiá»‡n qua **cÃ¡ch chá»n combo**, khÃ´ng pháº£i meta gÃ¡n trÆ°á»›c.
- **KhÃ´ng cáº§n** opponent state hay move trÆ°á»›c.

---

## ğŸ›¡ï¸ Rulebase Layer
- Kiá»ƒm tra tay bÃ i cÃ³ Ä‘á»§ Ä‘iá»u kiá»‡n bÃ¡o SÃ¢m trÆ°á»›c khi Ä‘Æ°a vÃ o ML.
- Rule chÃ­nh:
  - required_total_cards.
  - max_weak_combos.
  - min_strong_combos.
  - min_avg_strength.
  - min_high_ranks.
  - single_combo_strong_threshold.
- Náº¿u fail rule â†’ reject, khÃ´ng qua ML.

---

## ğŸ§  ML Layer

### Feature Design

#### 1. Combo-level
- Combo type (one-hot: single/pair/triple/straight/quad).
- Rank normalized.
- Strength (Sam-specific).
- Relative strength percentile trong hand.
- Length (náº¿u straight).

#### 2. Sequence-level
- Avg strength toÃ n sequence.
- Variance strength.
- Distribution combo types.
- Balance indicators (sá»‘ combo cá»±c máº¡nh: quads, 2s).
- Ordering pattern (strongest-first, type-priority).
- **Style indicator (implicit)**: rÃºt ra tá»« variance strength + cÃ¡ch phÃ¢n bá»• combo.

#### 3. Meta (tá»‘i thiá»ƒu)
- Player count (2/3/4) â†’ cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng threshold quyáº¿t Ä‘á»‹nh bÃ¡o.

---

### Label Design
- **Success (1)**: sequence unbeatable â†’ bÃ¡o thÃ nh cÃ´ng.
- **Fail (0)**: sequence khÃ´ng Ä‘á»§ Ä‘iá»u kiá»‡n.
- **Style khÃ´ng gÃ¡n trÆ°á»›c**: model tá»± há»c tá»« pattern combo (khÃ´ng cÃ³ risk_preference meta).

---

## âš™ï¸ Training Strategy
1. Phase 1 â€“ há»c tÃ­nh há»£p lá»‡ cá»§a sequence (Decision Tree / RF).
2. Phase 2 â€“ há»c implicit style tá»« cÃ¡ch user build combo (khÃ´ng gÃ¡n risk label).
3. Phase 3 â€“ threshold Ä‘iá»u chá»‰nh theo player_count + confidence.

---

## ğŸ”„ Sequence Ordering
- Máº·c Ä‘á»‹nh: sort combo máº¡nh â†’ yáº¿u vÃ  xáº£ háº¿t bÃ i.
- Náº¿u log user cho tháº¥y pattern khÃ¡c â†’ model cÃ³ thá»ƒ há»c thá»© tá»± riÃªng (vd. Æ°u tiÃªn quads trÆ°á»›c straights).

---
